<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Form Layout - Mazer Admin Dashboard</title>

    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="assets/css/bootstrap.css" />

    <link
      rel="stylesheet"
      href="assets/vendors/perfect-scrollbar/perfect-scrollbar.css"
    />
    <link
      rel="stylesheet"
      href="assets/vendors/bootstrap-icons/bootstrap-icons.css"
    />
    <link rel="stylesheet" href="assets/css/app.css" />
    <link
      rel="shortcut icon"
      href="assets/images/favicon.svg"
      type="image/x-icon"
    />
  </head>

  <body>
    <div id="app">
      <div id="sidebar" class="active">
        <div class="sidebar-wrapper active">
          <div class="sidebar-header">
            <div class="d-flex justify-content-between">
              <div class="logo">
                <a href="index.html"
                  ><img src="assets/images/logo/logo.png" alt="Logo" srcset=""
                /></a>
              </div>
              <div class="toggler">
                <a href="#" class="sidebar-hide d-xl-none d-block"
                  ><i class="bi bi-x bi-middle"></i
                ></a>
              </div>
            </div>
          </div>
          <div class="sidebar-menu">
            <ul class="menu">
              <li class="sidebar-title">Menu</li>

              <li class="sidebar-item">
                <a href="index.html" class="sidebar-link">
                  <i class="bi bi-grid-fill"></i>
                  <span>Dashboard</span>
                </a>
              </li>
              <li class="sidebar-item active">
                <a href="single-call.html" class="sidebar-link">
                  <i class="bi bi-file-earmark-medical-fill"></i>
                  <span>Single Call</span>
                </a>
              </li>
              <li class="sidebar-item">
                <a href="bulk-call.html" class="sidebar-link">
                  <i class="bi bi-stack"></i>
                  <span>Bulk Call</span>
                </a>
              </li>

              <li class="sidebar-item">
                <a href="call-logs.html" class="sidebar-link">
                  <i class="bi bi-journal-text"></i>
                  <span>Call Logs</span>
                </a>
              </li>

              <li class="sidebar-item">
                <a href="sms-email.html" class="sidebar-link">
                  <i class="bi bi-envelope-fill"></i>
                  <span>SMS & Email</span>
                </a>
              </li>

              <li class="sidebar-item">
                <a href="appointment.html" class="sidebar-link">
                  <i class="bi bi-calendar-check-fill"></i>
                  <span>Appointment</span>
                </a>
              </li>
            </ul>
          </div>
        </div>
      </div>
      <div id="main">
        <header class="mb-3">
          <a href="#" class="burger-btn d-block d-xl-none">
            <i class="bi bi-justify fs-3"></i>
          </a>
        </header>

        <div class="page-heading">
          <div class="page-title">
            <div class="row">
              <div class="col-12 col-md-6 order-md-1 order-last">
                <h3>Make Single Call</h3>
              </div>
              <div class="col-12 col-md-6 order-md-2 order-first">
                <nav
                  aria-label="breadcrumb"
                  class="breadcrumb-header float-start float-lg-end"
                >
                  <ol class="breadcrumb">
                    <li class="breadcrumb-item">
                      <a href="index.html">Dashboard</a>
                    </li>
                    <li class="breadcrumb-item active" aria-current="page">
                      Single Call
                    </li>
                  </ol>
                </nav>
              </div>
            </div>
          </div>

          <!-- Basic Horizontal form layout section start -->
          <section id="basic-horizontal-layouts" class="container mt-5">
            <div class="row justify-content-center">
              <div class="col-md-15">
                <div class="card">
                  <div class="card-content">
                    <div class="card-body">
                      <form class="form form-horizontal" id="call-form">
                        <div class="form-body">
                          <div class="row">
                            <div class="col-md-4">
                              <label>First Name</label>
                            </div>
                            <div class="col-md-8 form-group">
                              <input
                                type="text"
                                id="first-name"
                                class="form-control"
                                name="fname"
                                placeholder="First Name"
                              />
                            </div>
                            <div class="col-md-4">
                              <label>Mobile</label>
                            </div>
                            <div class="col-md-8 form-group">
                              <input
                                type="tel"
                                id="phone-number"
                                class="form-control"
                                name="contact"
                                placeholder="Mobile"
                              />
                            </div>
                            <div class="col-md-4">
                              <label>Prompt</label>
                            </div>
                            <div class="col-md-8 form-group">
                              <textarea
                                class="form-control"
                                id="prompt"
                                rows="3"
                              ></textarea>
                            </div>
                            <div class="col-sm-12 d-flex justify-content-end">
                              <button
                                type="submit"
                                class="btn btn-primary me-1 mb-1"
                              >
                                Submit
                              </button>
                              <button
                                type="reset"
                                class="btn btn-light-secondary me-1 mb-1"
                              >
                                Reset
                              </button>
                            </div>
                          </div>
                        </div>
                      </form>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>
          <!-- // Basic Horizontal form layout section end -->
        </div>
      </div>
    </div>
    <script src="assets/vendors/perfect-scrollbar/perfect-scrollbar.min.js"></script>
    <script src="assets/js/bootstrap.bundle.min.js"></script>

    <script src="assets/js/main.js"></script>
    <script>
      document.getElementById("call-form").addEventListener("submit", (e) => {
        e.preventDefault();
        const firstName = document.getElementById("first-name").value;
        const phoneNumberInput = document.getElementById("phone-number").value;
        const prompt = document.getElementById("prompt").value;

        // Validate and format the phone number
        const formattedPhoneNumber = formatPhoneNumber(phoneNumberInput);

        if (!formattedPhoneNumber) {
          alert(
            "Please enter a valid phone number with the country code (e.g., +1 for US)."
          );
          return;
        }

        const options = {
          method: "POST",
          headers: {
            Authorization: "Bearer 9f9ef4ba-5978-456f-a9b5-26bdde7d1ea2",
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            name: `Call with ${firstName}`,
            phoneNumberId: "5fb5c471-da97-4c67-a102-0ee3a91e1250",
            customer: {
              number: formattedPhoneNumber,
            },
            assistant: {
              firstMessage: `Hi ${firstName}, ${prompt}`,
              transcriber: {
                provider: "deepgram",
                model: "nova-2",
                language: "en-AU",
                smartFormat: false,
              },
              model: {
                provider: "openai",
                model: "gpt-4",
                messages: [
                  {
                    role: "system",
                    content: prompt,
                  },
                ],
                knowledgeBase: {
                  provider: "canonical",
                  fileIds: ["your-file-id"],
                },
              },
            },
          }),
        };

        fetch("https://api.vapi.ai/call", options)
          .then((response) => response.json())
          .then((response) => console.log(response))
          .catch((err) => console.error(err));
      });

      function formatPhoneNumber(phoneNumber) {
        // Remove any non-digit characters
        const cleaned = phoneNumber.replace(/\D/g, "");

        // Check if the number starts with a country code (e.g., +1)
        if (cleaned.startsWith("1") && cleaned.length === 11) {
          return `+${cleaned}`;
        } else if (cleaned.startsWith("1") && cleaned.length === 10) {
          return `+1${cleaned}`;
        } else if (cleaned.length === 10) {
          return `+1${cleaned}`;
        } else if (cleaned.length > 10) {
          return `+${cleaned}`;
        } else {
          return null;
        }
      }
    </script>
  </body>
</html>
